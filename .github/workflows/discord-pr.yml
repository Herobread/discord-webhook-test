name: Discord Notification
on:
  pull_request:
    types: [opened, ready_for_review]

jobs:
  discord_notification:
    runs-on: ubuntu-latest
    steps:
      - name: Notify Discord Forum
        if: github.event.pull_request.draft == false
        env:
          DISCORD_WEBHOOK: ${{ secrets.DISCORD_WEBHOOK }}
          PR_TITLE: ${{ github.event.pull_request.title }}
          PR_URL: ${{ github.event.pull_request.html_url }}
          PR_AUTHOR: ${{ github.actor }}
        run: |
          # Construct the JSON payload with "thread_name" (This becomes the Post Title)
          # We escape quotes to prevent the JSON from breaking if the PR title has quotes

          curl -H "Content-Type: application/json" \
          -d "{\"content\": \"ðŸš€ **Ready for Review** by **$PR_AUTHOR**\n$PR_URL\", \"thread_name\": \"$PR_TITLE\"}" \
          "$DISCORD_WEBHOOK"
